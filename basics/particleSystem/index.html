<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Particle Systems • A-Frame</title>
    <meta name="description" content="Hello, WebVR! • A-Frame">
    <script src="../../js/vendor/aframe-master.min.js"></script>
    <script src="../../js/vendor/RGBELoader.js"></script>
    <script src="../../js/vendor/PMREMGenerator.js"></script>
    <script src="../../js/systems/wireframe.js"></script>
    <script src="../../js/components/slideshow.js"></script>
    <script src="components/environment-map.js"></script>
    <script src="components/cloud.js"></script>
    <script src="components/drawcalls.js"></script>
    <script src="components/galaxy.js"></script>
    <script src="components/fireworks.js"></script>
    <script src="components/particle-system-shell.js"></script>
    <script src="components/particle-system-explosion.js"></script>
    <script src="components/particle-system-naive-wireframe.js"></script>
    <script src="components/particle-system-instanced.js"></script>
    <script src="components/particle-system-rocket-exhaust.js"></script>
    <script src="components/swap-entities.js"></script>
  </head>
  <body>
    <a-scene
      slideshow="slides: #slide1, #slide2, #slide3, #slide4, #slide5; firstSlideIndex: 0; enabled: false; loadAlwaysFirstSlide: false"
      renderer="alpha: false; antialias: true"
      background="color: white">
      <a-assets>
        <img id="particleImage" src="assets/particle.png" />
        <img id="particleFlame" src="assets/flame.png" />
        <img id="particleFirework" src="assets/firework.png" />
        <a-asset-item id="starship" src="assets/starship.glb"></a-asset-item>
      </a-assets>
      <a-entity id="slide1">
        <div class="slide">
          <div>
            <h1>Particle System</h1>
            <p>A particle system is a technique to represent smoke, fire, rain, fireworks... Usually phenomena composed of many small discrete elements that combined appear as a single entity or follow some common dynamics.</p>

            <p>The emitter is a location where the particles are created. Usually each particle has a time counter, recycled once expired and then reemitted for good use of resources.
            </p>

            <p>
            Each particle can be rendered in multiple ways. This example renders individual <a href="http://localhost:8080/basics/quad/#0">quads</a>. This results in a drawcall per particle which is very inefficient but keeps the code simple for illustration purposes.</p>

            <p>Draw Calls: <strong id='naiveParticleSystem'>0</strong></p>
          </div>
        </div>
        <a-entity camera position="-0.40 0 1" drawcalls="target: #naiveParticleSystem"></a-entity>
        <a-entity>
          <a-entity
            particle-system-naive-wireframe="particleSize: 0.03; particleSpeed: 0.003; particleLifeTime: 5000"
            position='0 -0.5 0'></a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="slide2">
        <div class="slide">
          <div>
            <h1>Particles Texture</h1>
            <p>We can apply a texture to a particle to change its appereance and simulate the desired effect.</p>

            <p>This example renders the quads using a technique called <a href="https://webglfundamentals.org/webgl/lessons/webgl-instanced-drawing.html">instanced drawing</a> to reduce the number of draw calls. Compare the number with the previous example.</p>

            <p>Draw Calls: <strong id='instancedParticleSystem'>0</strong></p>
          </div>
        </div>
         <a-entity camera position="-0.40 0 1" drawcalls="target: #instancedParticleSystem"></a-entity>
        <a-entity>
          <a-entity
            particle-system-instanced="particleSize: 0.03; src: #particleImage; particleSpeed: 0.002; particleLifeTime: 20000"
            position='0 0.2 0'></a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="slide3" background-color="#7998ba">
        <div class="slide">
          <div>
            <h1>Combine Particle Systems</h1>
            <p>Multiple particle systems can be combined to create a single effect. This is a crude representation of the <a href="https://en.wikipedia.org/wiki/SpaceX_Raptor">SpaceX Raptor engine </a> exhaust. We use 3 particle systems: One for the brighter exhaust coming out from the nozzle, one for the purple plume and a last one to represent the <a href="https://en.wikipedia.org/wiki/Shock_diamond"></a></p>
          </div>
        </div>
         <a-entity camera position="-0.40 0 1"></a-entity>
        <a-entity>
          <a-entity light="type: ambient; intensity: 2.4"></a-entity>
          <a-entity light="type: directional; intensity: 0.6"></a-entity>
          <a-entity
            gltf-model="#starship"
            environment-map
            scale="0.012 0.012 0.012"></a-entity>
          <a-entity
            particle-system-rocket-exhaust="particleSize: 0.08; src: #particleFlame; particleSpeed: 0.005; particleLifeTime: 2200; color: #4768ac; endColor: #c995ea; animateColor: true; endScaleFactor: 0.5"
            particle-system-rocket-exhaust__diamond="particleSize: 0.05; src: #particleFlame; particleSpeed: 0.005; particleLifeTime: 2200; color: white; shockDiamonds: true"
            particle-system-rocket-exhaust__fire="particleSize: 0.05; src: #particleFlame; particleSpeed: 0.005; particleLifeTime: 600; color: #c3da56; animateColor: true"
            position='0 -0.9 0'></a-entity>
            <a-entity cloud scale="5 5 1" position="-0.6 1 -1.5"></a-entity>
            <a-entity cloud="startTime: 2000" scale="5 5 1" position="1.8 1 -1.5">
          </a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="slide4">
        <div class="slide dark">
          <div>
            <h1>Chain Particle Systems</h1>
            <p>We can make effects composed of multiple particle systems. In this case we have a particle system for the shells and another one for the stars. One the shell particle finishes an event triggers the start of the firework stars</p>
          </div>
        </div>
         <a-entity camera position="-0.40 0 1"></a-entity>
        <a-entity>
          <a-entity
            fireworks
            position='0 -0.5 0'></a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="slide5">
        <div class="slide dark">
          <div>
            <h1>Complex Particle Behavior</h1>
            <p>Redefine the init and tick methods to animate the particles. A few lines of code can describe very complex behavior</p>
            <p>This is an interpretation of the <a href="https://en.wikipedia.org/wiki/Density_wave_theory">Density Wave Theory</a> that describes how the structure of spiral galaxies is formed. Observe how the galaxy rotates while the arms remain static. This is due to matter (planets, stars, dust...) going around in overlapping concentric eliptical orbits.</p>
            <p><a id="toggleOrbits" href="#" style="margin: auto">TOGGLE ORBITS</a></p>
          </div>
        </div>
         <a-entity camera position="-0.05 0 0.125"></a-entity>
        <a-entity>
          <a-entity swap-entities="toggleButton: #toggleOrbits; entity1: #galaxy; entity2: #galaxyOrbits">
            <a-entity
              id = "galaxy"
              galaxy="particleSize: 0.0006; src: #particleFirework; particleSpeed: 0.002;"
              position='0 -0.5 0'></a-entity>
            <a-entity
              id = "galaxyOrbits"
              galaxy="particleSize: 0.0006; src: #particleFirework; particleSpeed: 0.002; showOrbits: true"
              position='0 -0.5 0' visible="false"></a-entity>
          </a-entity>
        </a-entity>
      </a-entity>
    </a-scene>
  </body>
</html>